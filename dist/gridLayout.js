!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.GridLayout=e():t.GridLayout=e()}(window,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(t,e,i){"use strict";function n(t){return!!/%$/.test(t)&&.01*parseFloat(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.deepmerge=function(t){return JSON.parse(JSON.stringify(t))},e.parseAlignSpace=function(t,e,i){const n=[],s=(t=0)=>{for(let e=n.length;e<i+1;e++)n[e]=t};if(t<0&&("space-between"===e||"stretch"===e?e="start":"space-around"!==e&&"space-evenly"!==e||(e="center")),"end"===e)n[0]=t,s();else if("center"===e){const e=t/2;n[0]=e,s(),n[i]=e}else if("space-between"===e)n[0]=0,1===i?s(t):(s(t/(i-1)),n[i]=0);else if("space-around"===e){const e=t/i;n[0]=e/2,s(e),n[i]=e/2}else if("space-evenly"===e){s(t/(i+1))}else s();return n},e.parsePercentValue=n,e.parseMarginAuto=function(t,e=0){return"auto"===t?e:t||0},e.parseNumberValue=function(t,e){if("auto"===t||"number"==typeof t)return t;if(!t)return 0;const i=n(t);if("number"==typeof i)t=i*e;else{if(!/^[\d.-]+$/.test(t))throw new Error(t+" is not a number");t=parseFloat(t)}return t},e.parseMinMaxValue=function(t,e,i){return e&&t<e&&(t=e),i&&t>i&&(t=i),t},e.parseCombineValue=function(t){return Array.isArray(t)?1===t.length?t=[t[0],t[0],t[0],t[0]]:2===t.length?t=[t[0],t[1],t[0],t[1]]:3===t.length&&(t[3]=t[1]):t=[t,t,t,t],t}},function(t,e,i){"use strict";function n(t){return"px"===t.type||"%"===t.type}function s(t){return n(t)||["min-content","max-content","auto"].includes(t.type)}function r(t){return"minmax"===t.type}Object.defineProperty(e,"__esModule",{value:!0}),e.isFixedBreadth=n,e.isInflexibleBreadth=s,e.isTrackBreadth=function(t){return s(t)||"fr"===t.type},e.isAutoRepeat=function(t){return"auto-fill-repeat"===t.type||"auto-fit-repeat"===t.type},e.isAutoFitRepeat=function(t){return"auto-fit-repeat"===t.type},e.isFixedRepeat=function(t){return"fix-repeat"===t.type},e.isAutoTrack=function(t){return"auto"===t.type},e.isFrTrack=function(t){return"fr"===t.type},e.isMinMaxTrack=r,e.isFrMinMaxTrack=function(t){if(r(t)){return"fr"===t.args[1].type}return!1},e.isAutoMinMaxTrack=function(t){if(r(t)){return"auto"===t.args[1].type}return!1}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Parser=class{constructor(t){this.index=0,this.text=t}nextNeed(t){if(this.peek()!==t)throw new Error("next token must be "+t)}peek(){return this.tokens[this.index++]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Tokenizer=class{constructor(t){this.text=t||"",this.length=this.text.length}isWhitespace(t){return"  \n\r\t\f\v​᠎             　".indexOf(t)>-1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(5);e.Node=n.Node;var s=i(6);e.Container=s.Container},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0);let s=1;e.Node=class{constructor(t={}){this.id=1,this.boundingRect={},this.cells=[],this.placement={row:{start:-1,end:-1,size:1},column:{start:-1,end:-1,size:1}},this.id=s++,this.config=Object.assign({},t)}parse(){Object.keys(this.config).forEach(t=>{(t.startsWith("border")||t.startsWith("padding")||t.startsWith("margin"))&&this.parseCombineProperty(t)}),["gridRowStart","gridRowEnd","gridColumnStart","gridColumnEnd"].forEach(t=>{this.parseGridLine(t)}),this.parseSize(),this.config.alignSelf||(this.config.alignSelf="auto"),this.config.justifySelf||(this.config.justifySelf="auto")}parseGridLine(t){const e=this.config[t];if(e&&"auto"!==e)if("number"==typeof e)this.config[t]={integer:e};else{const i=e.split(/\s+/g).filter(t=>t),n={};i.forEach(i=>{if("span"===i){if(n.span)throw new Error(`${t}: ${e} is not valid`);n.span=!0}else/^\-?\d+$/.test(i)?n.integer=parseInt(i,10):n.customIdent=i}),this.config[t]=n}else this.config[t]={}}parseCombineProperty(t){const e=this.parent.config.width;if("border"===t||"padding"===t||"margin"===t){const i=n.parseCombineValue(t).map(t=>n.parseNumberValue(t,e));[t+"Top",t+"Right",t+"Bottom",t+"Left"].forEach((t,e)=>{this.config[t]=i[e]})}else this.config[t]=n.parseNumberValue(this.config[t],e)}parseSize(){const t=this.parent.config.width;this.config.width=n.parseNumberValue(this.config.width,t),this.config.minWidth=n.parseNumberValue(this.config.minWidth,t),this.config.maxWidth=n.parseNumberValue(this.config.maxWidth,t),this.config.minWidth>this.config.maxWidth&&(this.config.maxWidth=0);const e=this.parent.config.height;this.config.height=n.parseNumberValue(this.config.height,e),this.config.minHeight=n.parseNumberValue(this.config.minHeight,e),this.config.maxHeight=n.parseNumberValue(this.config.maxHeight,e),this.config.minHeight>this.config.maxHeight&&(this.config.maxHeight=0),this.config.minContentWidth=n.parseNumberValue(this.config.minContentWidth,t),this.config.maxContentWidth=n.parseNumberValue(this.config.maxContentWidth,t),this.config.minContentHeight=n.parseNumberValue(this.config.minContentHeight,e),this.config.maxContentHeight=n.parseNumberValue(this.config.maxContentHeight,e),this.boundingRect.width=this.getComputedWidth(this.config.minContentWidth),this.boundingRect.height=this.getComputedHeight(this.config.minContentHeight)}getComputedWidth(t=0){t=this.config.width||t||0;const e=this.config.minWidth;let i=this.config.maxWidth;return n.parseMinMaxValue(t,e,i)}getLayoutWidth(t=0){t=this.getComputedWidth(t);const e=n.parseMarginAuto(this.config.marginLeft),i=n.parseMarginAuto(this.config.marginRight);if(t+=e+i,"border-box"!==this.config.boxSizing){["borderLeft","borderRight","paddingLeft","paddingRight"].forEach(e=>{t+=this.config[e]||0})}return t}getComputedHeight(t=0){t=this.config.height||t||0;const e=this.config.minHeight;let i=this.config.maxHeight;return n.parseMinMaxValue(t,e,i)}getLayoutHeight(t=0){t=this.getComputedHeight(t);const e=n.parseMarginAuto(this.config.marginTop),i=n.parseMarginAuto(this.config.marginBottom);if(t+=e+i,"border-box"!==this.config.boxSizing){["borderTop","borderBottom","paddingTop","paddingBottom"].forEach(e=>{t+=this.config[e]||0})}return t}get minContentWidth(){return this.getLayoutWidth(this.config.minContentWidth)}get maxContentWidth(){return this.getLayoutWidth(this.config.maxContentWidth)}get minContentHeight(){return this.getLayoutHeight(this.config.minContentHeight)}get maxContentHeight(){return this.getLayoutHeight(this.config.maxContentHeight)}parseAutoMargin(t,e){const i="row"===t,s=i?this.config.marginTop:this.config.marginLeft,r="auto"===s,o="auto"===(i?this.config.marginBottom:this.config.marginRight);if(r||o){const t=i?e.height:e.width,a=i?this.getLayoutHeight():this.getLayoutWidth(),c=Math.max(0,t-a),h=i?"top":"left";return this.boundingRect[h]=r&&o?e[h]+c/2:r?e[h]+c:e[h]+n.parseMarginAuto(s),!0}return!1}parseAlign(t,e,i){const s="row"===e,r=s?"top":"left",o=s?"height":"width",a=s?i.height:i.width,c=s?this.getLayoutHeight():this.getLayoutWidth(),h=Math.max(0,a-c),u=n.parseMarginAuto(s?this.config.marginTop:this.config.marginLeft);switch(t){case"start":this.boundingRect[r]=i[r]+u;break;case"center":this.boundingRect[r]=i[r]+h/2+u;break;case"end":this.boundingRect[r]=i[r]+h+u;break;case"stretch":if(!this.config[o]){const t=s?this.config.minHeight:this.config.minWidth,e=s?this.config.maxHeight:this.config.maxWidth,r=n.parseMarginAuto(s?this.config.marginBottom:this.config.marginRight),a=n.parseMinMaxValue(i[o]-u-r,t,e);a>this.boundingRect[o]&&(this.boundingRect[o]=a)}this.boundingRect[r]=i[r]+u}}parsePosition(t){if(!this.parseAutoMargin("row",t)){let e=this.config.alignSelf;"auto"===e&&(e=this.parent.config.alignItems),this.parseAlign(e,"row",t)}if(!this.parseAutoMargin("column",t)){let e=this.config.justifySelf;"auto"===e&&(e=this.parent.config.justifyItems),this.parseAlign(e,"column",t)}}getComputedLayout(){return this.boundingRect}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(7),s=i(9),r=i(10),o=i(12);e.Container=class{constructor(t){this.children=[],this.config=Object.assign({},t)}appendChild(t){return t.parent=this,this.children.push(t),this}parseOrder(t){return t.sort((t,e)=>{const i=0|t.config.order,n=0|e.config.order;return t.config.order&&e.config.order?i>n?1:-1:t.config.order?i>0?1:-1:e.config.order?n>0?-1:1:t.id>e.id?1:-1}),t}parse(){if(this.parseOrder(this.children),["gridTemplateRows","gridTemplateColumns","gridAutoRows","gridAutoColumns"].forEach(t=>{const e=new n.TrackParser(this.config[t]);e.parse();const i=t.includes("Rows")?"row":"column",r=new s.RepeatTrackCompute(e.trackList,this,i);r.parse(),this.config[t]=r.trackList}),this.config.gridAutoFlow){const t=this.config.gridAutoFlow,e={};t.indexOf("column")>-1?e.column=!0:e.row=!0,t.indexOf("dense")>-1&&(e.dense=!0),this.config.gridAutoFlow=e}if(this.config.gridTemplateAreas&&"string"==typeof this.config.gridTemplateAreas){const t=new r.AreaParser(this.config.gridTemplateAreas).parse();this.config.gridTemplateAreas=t}this.config.gridRowGap=parseFloat(this.config.gridRowGap)||0,this.config.gridColumnGap=parseFloat(this.config.gridColumnGap)||0,["justifyContent","alignContent","alignItems","justifyItems"].forEach(t=>{this.config[t]||(this.config[t]="stretch")})}calculateLayout(){this.parse(),this.children.forEach(t=>{t.parse()}),new o.Composition(this).compose()}getAllComputedLayout(){this.children.sort((t,e)=>t.id>e.id?1:-1);const t={top:0,left:0,width:this.config.width,height:this.config.height};return t.children=this.children.map(t=>t.getComputedLayout()),t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(2),s=i(8),r=i(1);class o extends n.Parser{parse(){const t=new s.TrackTokenizer(this.text);this.tokens=t.getTokens(),this.length=this.tokens.length;const e=this.parseCondition(t=>!0,["minmax","fit-content","repeat"]);this.checkTrack(e),this.trackList=e}parseValue(t){if("auto"===t||"min-content"===t||"max-content"===t)return{type:t,baseSize:0,growthLimit:1/0};const e=t.match(/^(\d+(?:\.\d+)?)+(px|fr|%)?$/);if(e){const i=parseFloat(e[1]);if(i<0)throw new Error(t+" must be positive");if(!e[2]||"px"===e[2])return{value:i,type:"px",baseSize:i,growthLimit:i};if("%"===e[2])return{value:i,type:"%"};if("fr"===e[2])return{value:i,type:"fr",baseSize:0,growthLimit:0}}throw new Error(t+" is not allowed")}parseFitContent(){this.nextNeed("(");const t=this.peek();this.nextNeed(")");const e=this.parseValue(t);if(!r.isFixedBreadth(e))throw new Error(t+" is not allowed in fit-content");return{type:"fit-content",args:[e],baseSize:0,growthLimit:1/0}}parseMinMax(){this.nextNeed("(");const t=this.peek(),e=this.parseValue(t);this.nextNeed(",");const i=this.peek(),n=this.parseValue(i);if(this.nextNeed(")"),r.isInflexibleBreadth(e)&&r.isTrackBreadth(n)||r.isFixedBreadth(e)&&r.isTrackBreadth(n)||r.isInflexibleBreadth(e)&&r.isFixedBreadth(n))return{type:"minmax",args:[e,n],baseSize:0,growthLimit:1/0};throw new Error(`minmax(${e.value}${e.type}, ${n.value}${n.type}) is not allowd`)}parseLineNames(){const t=[];let e=!1;for(;this.index<this.length;){const i=this.peek();if("]"===i){e=!0;break}t.push(i)}if(!e)throw new Error("parse line names error");return t}parseRepeatNum(t){if("auto-fill"===t||"auto-fit"===t)return t;if(/^\d+$/.test(t)){const e=parseInt(t,10);if(e<=0)throw new Error(t+" is not allowd in repeat");return e}throw new Error(t+" is not allowed")}parseRepeat(){this.nextNeed("(");const t=this.parseRepeatNum(this.peek());this.nextNeed(",");let e=!1;const i=this.parseCondition(t=>{const i=")"!==t;return i||(e=!0),i},["minmax","fit-content"]);if(!e)throw new Error("can not find ) in repeat syntax");let n="fix-repeat";return"auto-fill"===t?n="auto-fill-repeat":"auto-fit"===t&&(n="auto-fit-repeat"),{type:n,args:[t,i]}}parseCondition(t,e){const i=[];let n=[];for(;this.index<this.length;){const s=this.peek();if(!t(s))break;let r;"["!==s?(r="minmax"===s&&e.includes("minmax")?this.parseMinMax():"fit-content"===s&&e.includes("fit-content")?this.parseFitContent():"repeat"===s&&e.includes("repeat")?this.parseRepeat():this.parseValue(s),r.lineNamesStart=n,r.lineNamesEnd=[],i.length&&(i[i.length-1].lineNamesEnd=n.slice()),n=[],i.push(r)):n=this.parseLineNames()}return n.length&&(i[i.length-1].lineNamesEnd=n),i}checkAutoRepeatTrack(t){t.forEach(t=>{const e=t.type;if("px"!==e&&"%"!==e){if("minmax"===e){const e=t.args[0],i=t.args[1];if(r.isFixedBreadth(e)&&r.isTrackBreadth(i))return;if(r.isInflexibleBreadth(e)&&r.isFixedBreadth(i))return}throw new Error(t.type+" not allowed in auto-repeat")}})}checkTrack(t){let e=0,i=0,n=0;if(t.forEach(t=>{switch(t.type){case"auto-fit-repeat":case"auto-fill-repeat":e++,this.checkAutoRepeatTrack(t.args[1]);break;case"auto":case"fit-content":case"min-content":case"max-content":i++;break;case"fr":n+=t.value}}),e>1||e&&(i||n))throw new Error("auto-repeat can not be combined with intrinsic or flexible sizes")}}e.TrackParser=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(3);class s extends n.Tokenizer{getTokens(){const t=[];let e="",i=0;for(;i<this.length;){const n=this.text[i],s=this.isWhitespace(n);s||"()[],/".indexOf(n)>-1?(e&&(t.push(e),e=""),i++,s||t.push(n)):(e+=n,i++)}return e&&t.push(e),t}}e.TrackTokenizer=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),s=i(1);e.RepeatTrackCompute=class{constructor(t,e,i){this.trackList=t,this.container=e,this.type=i}expandFixedRepeat(t,e){const i=e||t.args[0],s=t.args[1],r=[];let o=0;for(;o++<i;)s.forEach(t=>{r.push(n.deepmerge(t))});return r}get size(){return"row"===this.type?this.container.config.height:this.container.config.width}get gap(){return"row"===this.type?this.container.config.gridRowGap:this.container.config.gridColumnGap}getTrackItemValue(t){switch(t.type){case"px":return t.value;case"%":return Math.round(t.value*this.size/100);case"minmax":const e=t.args[0],i=t.args[1];return s.isFixedBreadth(e)?e.value:i.value}return 0}parseAutoRepeat(){const t=this.gap;let e,i,n=0,r=!1;this.trackList.forEach((t,o)=>{n+=this.getTrackItemValue(t),s.isAutoRepeat(t)&&(e=t,i=o,r=s.isAutoFitRepeat(t))});let o=this.size-n,a=0;const c=e.args[1];c.forEach(t=>{a+=this.getTrackItemValue(t)});let h=1;if(o>a&&(h=Math.floor(o/a),t)){const e=this.trackList.length-1,i=c.length;for(;h>1;){if(o-t*(e+i*h-1)-h*a>0)break;h--}}const u=this.expandFixedRepeat(e,h);r&&u.forEach(t=>{t.autoFit=!0}),this.trackList.splice(i,1,...u)}mergeLineNames(){const t=this.trackList.length;for(let e=0;e<t-1;e++){const t=this.trackList[e],i=this.trackList[e+1],n=t.lineNamesEnd.concat(i.lineNamesStart),s=new Set(n);t.lineNamesEnd=[...s],i.lineNamesStart=[...s]}}parse(){const t=[];let e=!1;this.trackList.forEach(i=>{s.isFixedRepeat(i)?t.push(...this.expandFixedRepeat(i)):(s.isAutoRepeat(i)&&(e=!0),t.push(i))}),this.trackList=t,e&&this.parseAutoRepeat(),this.mergeLineNames()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(2),s=i(11);class r extends n.Parser{parse(){const t=new s.AreaTokenizer(this.text).getTokens(),e=Math.max(...t.map(t=>t.length)),i=[...new Array(e)],n=[];return t.forEach((e,s)=>{i.forEach((i,r)=>{const o=(e[r]||"").replace(/\.+/,"");""===o||n.includes(o)||(this.checkAreaName(t,s,r),n.push(o)),e[r]=o})}),t}checkAreaName(t,e,i){const n=t[e][i];let s=e,r=i;for(let o=e,a=t.length;o<a;o++){for(let a=o===e?i+1:0;a<t[o].length;a++){if(t[o][a]===n){if(a<i)throw new Error("areas is not valid");s=Math.max(s,o),r=Math.max(r,a)}}}for(let o=e;o<=s;o++)for(let e=i;e<=r;e++)if(t[o][e]!==n)throw new Error("areas is not valid")}}e.AreaParser=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(3);class s extends n.Tokenizer{getTokens(){const t=[];let e=[],i="",n=0,s=!1;for(;n<this.length;){const r=this.text[n];if('"'===r)s?(s=!1,i&&(e.push(i),i=""),t.push(e),e=[]):s=!0;else{this.isWhitespace(r)?i&&(e.push(i),i=""):i+=r}n++}if(i)throw new Error("area syntax error");return t}}e.AreaTokenizer=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(13),s=i(14);e.Composition=class{constructor(t){this.container=t;const e=new n.GridCompute(this.container),i=this.container.config.gridTemplateAreas;i&&i.length&&e.setAreas(i);const s=this.container.children;e.putNodes(s),this.cells=e.cells,this.rowTrack=e.rowTrack,this.columnTrack=e.columnTrack}parseCellSize(){this.cells.forEach((t,e)=>{t.forEach((t,i)=>{t.width=this.columnTrack[i].baseSize,t.height=this.rowTrack[e].baseSize,t.top=this.rowTrack[e].pos,t.left=this.columnTrack[i].pos})})}parseNodeSize(){this.container.children.map(t=>{const e=[],i=[],n=[],s=[];t.cells.forEach(t=>{e.push(t.top),i.push(t.left),s.push(t.left+t.width),n.push(t.top+t.height)});const r={top:Math.min(...e),left:Math.min(...i)};r.width=Math.max(...s)-r.left,r.height=Math.max(...n)-r.top,t.parsePosition(r)})}compose(){new s.TrackCompute(this.rowTrack,this.cells,this.container,"row").parse(),new s.TrackCompute(this.columnTrack,this.cells,this.container,"column").parse(),this.parseCellSize(),this.parseNodeSize()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0);e.GridCompute=class{constructor(t){this.cells=[],this.areaNames={},this.autoRowIndex=0,this.autoColumnIndex=0,this.container=t,this.rowTrack=t.config.gridTemplateRows,this.initRowTrackSize=this.rowTrack.length,this.columnTrack=t.config.gridTemplateColumns,this.initColumnTrackSize=this.columnTrack.length,this.autoRowTrack=t.config.gridAutoRows,this.autoRowTrack.length||(this.autoRowTrack[0]=this.defaultAutoTrack),this.rowTrack.length||(this.rowTrack[0]=n.deepmerge(this.autoRowTrack[0])),this.autoColumnTrack=t.config.gridAutoColumns,this.autoColumnTrack.length||(this.autoColumnTrack[0]=this.defaultAutoTrack),this.columnTrack.length||(this.columnTrack[0]=n.deepmerge(this.autoColumnTrack[0])),this.autoFlow=this.container.config.gridAutoFlow||{}}get defaultAutoTrack(){return{type:"auto",baseSize:0,growthLimit:1/0,lineNamesStart:[],lineNamesEnd:[]}}get rowSize(){return this.rowTrack.length}get columnSize(){return this.columnTrack.length}getInitCell(t,e){return{row:t||0,column:e||0,node:[]}}putNodeInCell(t,e,i){this.cells[t]||(this.cells[t]=[],this.flexTrackSize("row",t+1)),this.flexTrackSize("column",e+1),this.cells[t][e]||(this.cells[t][e]=this.getInitCell(t,e)),this.cells[t][e].node.push(i),i.cells.push(this.cells[t][e])}flexTrackSize(t,e){const i="row"===t,s=i?this.rowTrack:this.columnTrack;if(s.length<e){const t=i?this.autoRowTrack:this.autoColumnTrack,r=t.length;for(let o=s.length;o<e;o++)s[o]=i?n.deepmerge(t[this.autoRowIndex++%r]):n.deepmerge(t[this.autoColumnIndex++%r])}}setAreas(t){this.flexTrackSize("row",t.length),this.flexTrackSize("column",t[0].length),t.length>this.initRowTrackSize&&(this.initRowTrackSize=t.length),t[0].length>this.initColumnTrackSize&&(this.initColumnTrackSize=t[0].length),t.forEach((e,i)=>{e.forEach((e,n)=>{if(!e)return;this.areaNames[e]||(this.areaNames[e]=[]),this.areaNames[e].push({row:i,column:n});const s=e+"-start",r=e+"-end";i?t[i-1][n]!==e&&(this.rowTrack[i].lineNamesStart.push(s),this.rowTrack[i-1].lineNamesEnd.push(s)):this.rowTrack[i].lineNamesStart.push(s),i===t.length-1?this.rowTrack[i].lineNamesEnd.push(r):t[i+1][n]!==e&&(this.rowTrack[i].lineNamesEnd.push(r),this.rowTrack[i+1].lineNamesStart.push(r)),n?t[i][n-1]!==e&&(this.columnTrack[n].lineNamesStart.push(s),this.columnTrack[n-1].lineNamesEnd.push(s)):this.columnTrack[n].lineNamesStart.push(s),n===t[i].length-1?this.columnTrack[n].lineNamesEnd.push(r):t[i][n+1]!==e&&(this.columnTrack[n].lineNamesEnd.push(r),this.columnTrack[n+1].lineNamesStart.push(r))})})}putNodes(t){const e=[],i=[];t.forEach(t=>{const n=t.config.gridArea;if(n)return void(this.areaNames[n]?this.areaNames[n].forEach(e=>{this.putNodeInCell(e.row,e.column,t)}):this.putNodeInCell(this.initRowTrackSize+1,this.initColumnTrackSize+1,t));const{gridRowStart:s,gridRowEnd:r,gridColumnStart:o,gridColumnEnd:a}=t.config,c=this.parseGridPlacement(this.rowTrack,s,r,this.initRowTrackSize),h=this.parseGridPlacement(this.columnTrack,o,a,this.initColumnTrackSize);if(t.placement={row:c,column:h},c.start>-1&&h.start>-1)for(let e=c.start;e<c.end;e++)for(let i=h.start;i<h.end;i++)this.putNodeInCell(e,i,t);else c.start>-1&&(this.flexTrackSize("row",c.end),!this.autoFlow.column)||h.start>-1&&(this.flexTrackSize("column",h.end),this.autoFlow.column)?i.push(t):e.push(t)}),this.putGivedNodes(i),this.putAutoNodes(e)}putGivedNodes(t){let e=0;t.forEach(t=>{const i=t.placement.row.start>-1,n=i?t.placement.row:t.placement.column;let s=e;for(;;){let e=!0;for(let t=n.start;t<n.end;t++){const n=i?t:s,r=i?s:t;if(this.cells[n]&&this.cells[n][r]&&this.cells[n][r].node.length){e=!1;break}}if(e){for(let e=n.start;e<n.end;e++){const n=i?e:s,r=i?s:e;this.putNodeInCell(n,r,t)}break}s++}this.flexTrackSize(i?"row":"column",s),e=this.autoFlow.dense?0:s})}tryToSetNode(t,e,i){const{row:n,column:s}=t.placement;if(n.start>-1&&n.start!==e)return!1;if(s.start>-1&&s.start!==i)return!1;const r=-1===n.end?e+n.size:n.end,o=-1===s.end?i+s.size:s.end;for(let t=e;t<r;t++)for(let e=i;e<o;e++)if(this.cells[t]&&this.cells[t][e]&&this.cells[t][e].node.length)return!1;for(let n=e;n<r;n++)for(let e=i;e<o;e++)this.putNodeInCell(n,e,t);return!0}putAutoNodes(t){let e=0,i=0;t.forEach(t=>{if(!!this.autoFlow.column){let n=i;const s=this.rowSize;for(;;){let r=!1;for(let i=e;i<s;i++)if(this.tryToSetNode(t,i,n)){e=i,r=!0;break}if(r){i=n;break}e=0,n++}this.flexTrackSize("column",n+1)}else{let n=e;const s=this.columnSize;for(;;){let r=!1;for(let e=i;e<s;e++)if(this.tryToSetNode(t,n,e)){i=e,r=!0;break}if(r){e=n;break}i=0,n++}this.flexTrackSize("row",n+1)}this.autoFlow.dense&&(e=i=0)})}findPositionByCustomIdent(t,e,i){let n=-1,s=0,{customIdent:r,integer:o=1}=e;return o<0&&(t=t.reverse(),o=-o),t.some((t,e)=>{if(("start"===i?t.lineNamesStart:t.lineNamesEnd).includes(r)&&s++,s===o)return n=e,"end"===i&&(n+=1),!0}),n}parseGridPlacement(t,e,i,n){const s={start:-1,end:-1,size:1};if(e.span){if(i.span){if(e.customIdent)return s;if(e.integer)return s.size=e.integer,s}else i.customIdent?(s.end=this.findPositionByCustomIdent(t,i,"end"),-1===s.end&&(s.end=n+1)):i.integer&&(i.integer>-1?s.end=i.integer-1:s.end=t.length+i.integer+1);if(e.customIdent){if(s.end>-1)for(let i=s.end-1;i>=0;i--){let n=[];if(t[i]?n=t[i].lineNamesStart:i>0&&t[i-1]&&(n=t[i-1].lineNamesEnd),n.includes(e.customIdent)){s.start=i;break}}}else e.integer&&(s.start=Math.max(0,s.end-e.integer),s.end=s.start+e.integer)}else{if(e.customIdent){if(s.start=this.findPositionByCustomIdent(t,e,"start"),-1===s.start){const e=n+1;if(!i.span&&i.customIdent){const n=this.findPositionByCustomIdent(t,i,"start");return n>-1?(s.start=n,s.end=e):(s.start=e,s.end=s.start+1),s}if(!i.span&&i.integer){const t=i.integer-1;return t>e?(s.start=e,s.end=t):(s.start=t,s.end=e===t?e+1:e),s}}}else e.integer&&(s.start=e.integer-1);if(i.span)if(-1===s.start&&(s.start=0),i.customIdent){for(let e=s.start;e<t.length;e++)if(t[e].lineNamesEnd.includes(i.customIdent)){s.end=e+1;break}-1===s.end&&(s.end=n+1)}else i.integer&&(s.end=s.start+i.integer);else if(i.customIdent){if(s.end=this.findPositionByCustomIdent(t,i,"end"),-1===s.end)if(!e.span&&e.customIdent){const e=this.findPositionByCustomIdent(t,i,"start");-1===e?s.end=n+1:e<s.start&&(s.end=s.start,s.start=e)}else e.span||e.customIdent||e.integer||(s.end=n+1)}else i.integer&&(i.integer<0?s.end=t.length+i.integer+1:s.end=i.integer-1)}if(s.start>-1&&-1===s.end?s.end=s.start+1:s.end>-1&&-1===s.start?s.start=s.end-1:-1!==s.start&&s.start===s.end&&s.end++,s.start>s.end){const t=s.end;s.end=s.start,s.start=t}return s}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(1),s=i(0);e.TrackCompute=class{constructor(t,e,i,n){this.trackList=t,this.cells=e,this.container=i,this.type=n;const s=this.container.config,r="row"===this.type?s.gridRowGap:s.gridColumnGap;this.gap=r,this.containerSize="row"===this.type?s.height:s.width}parseTrackItemValue(t,e){switch(t.type){case"min-content":return this.parseMinContent(e);case"max-content":return this.parseMaxContent(e);case"fit-content":return this.parseFitContent(t,e);case"%":return t.value*this.containerSize/100;case"auto":return this.parseMinContent(e);case"px":return t.value}return-1}removeEmptyAutoFitTrack(){const t=[];this.trackList.forEach((e,i)=>{if(e.autoFit){if(0===this.getTrackNodes(i).length)return}t.push(e)}),this.trackList=t}parseTrackSize(){this.trackList.forEach((t,e)=>{if(n.isMinMaxTrack(t)){const i=t.args[0],n=t.args[1],s=this.parseTrackItemValue(i,e),r=this.parseMinContent(e),o=this.parseTrackItemValue(n,e);o>-1?(t.growthLimit=o,t.baseSize=Math.max(s,Math.min(r,o))):t.baseSize=Math.max(s,r),t.growthLimit<t.baseSize&&(t.growthLimit=t.baseSize)}else{const i=this.parseTrackItemValue(t,e);i>-1&&(t.baseSize=i)}})}getTrackNodes(t){const e="row"===this.type?this.cells[t]:this.cells.map(e=>e[t]),i=[];return(e||[]).forEach(t=>{t&&t.node&&i.push(...t.node)}),i}getNodeInCellSize(t,e,i){const s=t.cells;if(1===s.length)return e;let r=0,o=0;if(s.forEach((t,e)=>{const i="row"===this.type?t.row:t.column;0===e?(r=i,o=i):(r=Math.min(r,i),o=Math.max(o,i))}),r===o)return e;let a=0;for(let t=r;t<=o;t++){const i=this.trackList[t];n.isFixedBreadth(i)?e-=i.baseSize:a++}const c=Math.round(Math.max(0,e)/a);return i===o?e-c*(a-1):c}parseMinContent(t){const e=this.getTrackNodes(t).map(e=>{const i="row"===this.type?e.minContentHeight:e.minContentWidth;return this.getNodeInCellSize(e,i,t)});return 0===e.length?0:Math.max(...e)}parseMaxContent(t){const e=this.getTrackNodes(t).map(e=>{const i="row"===this.type?e.maxContentHeight:e.maxContentWidth;return this.getNodeInCellSize(e,i,t)});return 0===e.length?0:Math.max(...e)}parseFitContent(t,e){const i=t.args[0];if("%"===i.type){const t=this.container.config;i.value*=("row"===this.type?t.height:t.width)/100}const n=this.parseMinContent(e),s=this.parseMaxContent(e);return Math.min(s,Math.max(n,i.value))}parseFrTrack(){let t=0,e=this.freeSpace;if(this.trackList.forEach(i=>{if(n.isFrTrack(i))t+=i.value;else if(n.isMinMaxTrack(i)){const s=i.args[1];n.isFrTrack(s)?t+=s.value:n.isAutoTrack(s)?e-=i.baseSize:e-=i.growthLimit}else e-=i.baseSize}),t)for(t=Math.max(1,t);;){const i=Math.max(0,e)/t;let s=!1;if(this.trackList.forEach((r,o)=>{if(n.isFrTrack(r)){const n=r.value*i,a=this.parseMinContent(o);n<a&&(t-=r.value,e-=a,r.baseSize=a,r.growthLimit=r.baseSize,r.type="px",s=!0)}else if(n.isFrMinMaxTrack(r)){const n=r.args[1];n.value*i<r.baseSize&&(t-=n.value,e-=r.baseSize,r.growthLimit=r.baseSize,n.value=r.baseSize,n.type="px",s=!0)}}),!s){this.trackList.forEach((t,e)=>{if(n.isFrTrack(t))t.baseSize=t.value*i,t.type="px";else if(n.isFrMinMaxTrack(t)){const e=t.args[1],n=e.value*i;e.value=n,e.type="px",t.growthLimit=n,t.growthLimit<t.baseSize&&(t.growthLimit=t.baseSize)}});break}}}parseMinMaxTrack(){let t=this.freeSpace,e=0;if(this.trackList.forEach(i=>{if(t-=i.baseSize,n.isMinMaxTrack(i)){const t=i.args[1];n.isAutoTrack(t)||e++}}),e&&!(t<0))for(;;){const i=t/e;let s=!1;if(this.trackList.forEach(r=>{if(n.isMinMaxTrack(r)){const o=r.args[1];!n.isAutoTrack(o)&&r.growthLimit<r.baseSize+i&&(r.baseSize=r.growthLimit,t-=r.growthLimit-r.baseSize,e--,s=!0)}}),!s){this.trackList.forEach(t=>{if(n.isMinMaxTrack(t)){const e=t.args[1];!n.isAutoTrack(e)&&t.growthLimit>t.baseSize&&(t.baseSize+=i)}});break}}}parseAutoTrack(){const t=this.container.config;if("column"===this.type&&"stretch"!==t.justifyContent)return;if("row"===this.type&&"stretch"!==t.alignContent)return;let e=this.freeSpace,i=0;if(this.trackList.forEach(t=>{e-=t.baseSize,(n.isAutoTrack(t)||n.isAutoMinMaxTrack(t))&&i++}),!i||e<0)return;let s=Math.round(e/i),r=0;this.trackList.forEach(t=>{(n.isAutoTrack(t)||n.isAutoMinMaxTrack(t))&&(r===i-1&&(s=e-s*r),t.baseSize+=s,r++)})}parseTrackPosition(){let t=this.freeSpace;this.trackList.forEach(e=>{t-=e.baseSize});const e=this.container.config,i="row"===this.type?e.alignContent:e.justifyContent,n=s.parseAlignSpace(t,i,this.trackList.length);let r=0;this.trackList.forEach((t,e)=>{t.pos=r+n[e],r=t.pos+t.baseSize+this.gap})}parse(){this.removeEmptyAutoFitTrack(),this.freeSpace=this.containerSize-this.gap*(this.trackList.length-1),this.parseTrackSize(),this.parseFrTrack(),this.parseMinMaxTrack(),this.parseAutoTrack(),this.parseTrackPosition()}}}])}));